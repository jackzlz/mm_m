define("biz/product_list",["./product_edit"],function(a){function b(){var a,b,d,e;d={name:"置顶",icon:LT.getBasePath()+"/webApps/manager/img/top.png",action:function(){j()}},e={name:"编辑详情",icon:LT.getBasePath()+"/webApps/manager/img/edit_detail.png",action:function(){k()}},b=[{name:"查看详情",icon:LT.getBasePath()+"/webApps/manager/img/preview.png",action:function(){i()}},e,d],a={url:"product",menu:b,finish:function(){o.menus.topmenu=d,o.menus.detailmenu=e,c()}},a.tableParam={onRightClickRow:l},o=LT.SimplePage.create(),o.build(a)}function c(){f(proTypeArr),d(),h(o.form.getElement("type1"),o.form.getElementValue(o.form.getElement("type").content)),o.form.getElement("enterpriseNo")&&(o.form.getElement("enterpriseNo").event.change=function(a){g(a)}),o.form.getElement("type").event.change=function(a){h(o.form.getElement("type1"),a)},o.customButton["查询"].click(function(){o.fireQuery(),d()}),o.menus.add.name="新增产品",o.menus.edit.name="修改产品",o.maxAdd=!0,o.maxEdit=!0}function d(a){var b,c,d=[],f=[],g=o.dataTable.param.model.tableCols;for(a=a||o.form.getElementValue(o.form.getElement("type").content),b=0;b<g.length;b++)c=e(g[b],a),c?f.push(g[b].proName):d.push(g[b].proName);o.dataTable.hideCol(d),o.dataTable.showCol(f),o.dataTable.table.jqGrid("clearGridData")}function e(a,b){var c,d=!1,e=a.productTypes;if(a.hidden)return!1;if(!e||!e.length)return!0;for(c=0;c<e.length;c++){if("ALL"===e[c]){d=!0;break}if(e[c]===b){d=!0;break}}return d}function f(a){for(var b,c={},d=0;d<a.length;d++)b=a[d],b.paramValue.match("^{(.+:.+,*){1,}}$")&&(c=JSON.parse(b.paramValue)),p[b.paramKey]=c}function g(a){$.getJSON("product_getProductTypesByEnterpriseNo.action",{enterpriseNo:a},function(a){var b,c,d,e={"":"请选择"};for(b=a.productTypes,f(b),c=0;c<b.length;c++)d=b[c].paramValue,d.match("^{(.+:.+,*){1,}}$")&&(d=JSON.parse(d).name),e[b[c].paramKey]=d;o.form.getElement("type").content.refresh(e),o.form.getElement("type").content.change()})}function h(a,b){var c,d,e={"":"请选择"};if(c=p[b],c&&(d=c.children))for(var f=0;f<d.length;f++)e[d[f].code]=d[f].name;a.content.refresh(e)}function i(){var a=m("shareId");return a?void window.open(LT.getBasePath()+"/webApps/public/share/show.html?id="+a):void LT.infomation({content:"当前产品没有详情！"})}function j(){var a=m("id");return null===a?void LT.infomation({content:"没有选中记录！"}):void LT.asynPost("product_top.action",{id:a},function(a){o.refresh(),LT.infomation({content:"操作成功！"})})}function k(){var a=m("id"),b=m("shareId"),c=LT.startProgress({message:"正在初始化界面"}),d=LT.showPage({url:"share_toEdit.action?proid="+a+"&id="+b,title:"编辑产品详情",width:"100%",height:"100%"},function(){d.find("iframe")[0].contentWindow.closeMe=function(){d.close(),o.refresh()},c.stopProgress(!0)})}function l(a,b,c,d){var e,f=n(),g=f.id;return null===g?void LT.infomation({content:"没有选中记录！"}):(e=f.top,o.menus.topmenu.name="置顶",void(e&&"0"!==e&&(o.menus.topmenu.name="取消置顶")))}function m(a){var b=n();return b?b[a]:null}function n(){return o.dataTable.getSelectedRowData()}var o,p={};b(),a("./product_edit")}),define("biz/product_edit",[],function(a){function b(a){d(proTypeArr),f(null,a),a.getElement("enterpriseNo")&&(a.getElement("enterpriseNo").event.change=function(b){e(b,a)}),a.getElement("type").event.change=function(b){f(b,a)}}function c(a){d(proTypeArr),f(null,a),a.getElement("enterpriseNo")&&(a.getElement("enterpriseNo").event.change=function(b){e(b,a)}),a.getElement("type").event.change=function(b){f(b,a)},a.getElement("type").content.attr("readonly",!0)}function d(a){for(var b,c={},d=0;d<a.length;d++)b=a[d],b.paramValue.match("^{(.+:.+,*){1,}}$")&&(c=JSON.parse(b.paramValue)),i[b.paramKey]=c}function e(a,b){$.getJSON("product_getProductTypesByEnterpriseNo.action",{enterpriseNo:a},function(a){var c,e,f,g={"":"请选择"};for(c=a.productTypes,d(c),e=0;e<c.length;e++)f=c[e].paramValue,f.match("^{(.+:.+,*){1,}}$")&&(f=JSON.parse(f).name),g[c[e].paramKey]=f;b.getElement("type").content.refresh(g),b.getElement("type").content.change()})}function f(a,b){var c,d,e,f,i=b.model.formItems;for(a=a||b.getElementValue(b.getElement("type").content),d=0;d<i.length;d++)c=i[d],f=b.getElement(c.name).root,e=g(c,a),e?f.show():f.hide();h(b.getElement("type1"),a)}function g(a,b){var c,d=!1,e=a.productTypes;if(!e||!e.length)return!0;for(c=0;c<e.length;c++){if("ALL"===e[c]){d=!0;break}if(e[c]===b){d=!0;break}}return d}function h(a,b){var c,d,e={"":"请选择"};if(c=i[b],c&&(d=c.children))for(var f=0;f<d.length;f++)e[d[f].code]=d[f].name;a.content.refresh(e)}var i={};window.simplePageAdd=b,window.simplePageEdit=c});